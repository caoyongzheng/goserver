webpackJsonp([29],{246:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(1),l=o(u),c={login:{display:"block",margin:"auto",width:"400px",height:"300px",backgroundColor:"rgb(255, 255, 255)",color:"#000"}},p=function(e){function t(e){r(this,t);var n=a(this,Object.getPrototypeOf(t).call(this,e));return n.handleChangeUserName=function(e){n.setState({username:e.target.value})},n.handleLogin=function(){n.props.onChange(n.state.username)},n.state={username:""},n}return i(t,e),s(t,[{key:"render",value:function(){var e=this.state.username;return l["default"].createElement("div",{name:"login",style:c.login},l["default"].createElement("div",{name:"title"},"登录"),l["default"].createElement("div",{name:"form"},l["default"].createElement("label",{htmlFor:"user"},"Username"),l["default"].createElement("input",{value:e,onChange:this.handleChangeUserName}),l["default"].createElement("div",{name:"submit"},l["default"].createElement("button",{onClick:this.handleLogin},"登录"))))}}]),t}(l["default"].Component);p.propTypes={onChange:u.PropTypes.func.isRequired},t["default"]=p},247:function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function a(e,t){var o=this;n(this,a),this.handleSuccess=function(e){return o.handleSuccessFn=e,o},this.onSuccess=function(e){o.handleSuccessFn&&o.handleSuccessFn(e)},this.handleError=function(e){return o.handleErrorFn=e,o},this.onError=function(e){o.handleErrorFn&&o.handleErrorFn(e)},this.path=e,this.kind=t},r=function i(e){var t=this;n(this,i),this.broadcast=function(e,n,o){t.send({path:e,dataName:n,content:o,kind:"Broadcast"})},this.subscription=function(e){return 0===t.webSocket.readyState?t.toSubscriptions(function(){t.send({path:e,kind:"Subscription"})}):t.send({path:e,kind:"Subscription"}),t.accept(e,"Subscription")},this.accept=function(e){var n=arguments.length<=1||void 0===arguments[1]?"Broadcast":arguments[1],r=new o(e,n);return t.accepts[e+":"+n]=r,r},this.onopen=function(e){t.handleOpen=e},this.onclose=function(e){t.handleClose=e},this.send=function(e){t.webSocket.send(JSON.stringify(e))},this.webSocket=new WebSocket(e),this.accepts={},this.toSubscriptions=[],this.webSocket.onmessage=function(e){var n=JSON.parse(e.data),o=t.accepts[n.path+":"+n.kind];o&&(n.status&&o.onSuccess?o.onSuccess(n):!n.status&&o.onError&&o.onError(n))},this.webSocket.onopen=function(){t.handleOpen&&t.handleOpen(),t.toSubscriptions.forEach(function(e){e()})},this.webSocket.onclose=function(){t.handleClose&&t.handleClose()}};t["default"]=r},248:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(1),l=o(u),c=n(247),p=o(c),f=n(12),d=o(f),h={groupsStage:{position:"absolute",width:"200px",height:"100%",left:0,top:0,backgroundColor:"rgba(255, 148, 124, 0.45)"},group:{position:"relative",width:"100%",height:"30px",cursor:"pointer"},groupItem:{position:"absolute",width:"100%",height:"30px"},deleteItem:{position:"absolute",right:0,height:"30px",padding:"0 10px",backgroundColor:"rgb(0, 0, 0)"},msgStage:{position:"absolute",height:"100%",top:0,left:"200px",right:"200px",backgroundColor:"rgb(255, 37, 37)"},msgView:{position:"absolute",width:"100%",top:0,bottom:"120px",overflow:"auto",backgroundColor:"rgb(249, 232, 61)"},msgPost:{position:"absolute",width:"100%",bottom:0,height:"120px",display:"flex",alignItems:"center",justifyContent:"center",overflow:"auto"},msgInput:{height:"25px",width:"75%",border:"solid 1px #ddd",outline:"none"},msgButton:{height:"25px",width:"40px",border:"solid 1px #ddd",outline:"none"},msg:{width:"100%",padding:"6px 10px",color:"#000",backgroundColor:"rgb(55, 161, 18)",border:"solid 1px rgb(241, 244, 24)",marginTop:"-1px"},membersStage:{position:"absolute",width:"200px",height:"100%",right:0,top:0,backgroundColor:"rgba(255, 148, 124, 0.45)"}},g=function(e){function t(e){r(this,t);var n=a(this,Object.getPrototypeOf(t).call(this,e));return n.joinGroup=function(e){n.myChat.subscription(e).handleSuccess(function(){var t={path:e,msgs:[],members:[]},o=n.state.groups;o[e]=t,n.setState({groups:o}),n.listen(e)}).handleError(function(){console.log("Failed to join group:"+e)})},n.listen=function(e){var t=n.myChat.accept(e);t.handleSuccess(function(t){if("Msg"===t.dataName){var o=n.state.groups[e];o.msgs.push(t.content),n.setState({groups:n.state.groups})}else if("Members"===t.dataName){var r=n.state.groups[e];r.members=t.content,n.setState({groups:n.state.groups})}})},n.handleClickAdd=function(){n.joinGroup(n.state.path),n.setState({path:""})},n.handleClickPost=function(){var e=n.state,t=e.msg,o=e.active;t&&(o?n.myChat.broadcast(o,"Msg",t):console.log("faild to send message,should select a group"))},n.clickGroup=function(e){n.setState({active:e})},n.handleExitGroup=function(e,t){e.preventDefault(),n.myChat.send({path:t,kind:"ExitGroup"})},n.handleChangeMsg=function(e){n.setState({msg:e.target.value})},n.handleChangePath=function(e){n.setState({path:e.target.value})},n.state={groups:{},active:"",path:"",msg:""},n}return i(t,e),s(t,[{key:"componentDidMount",value:function(){this.myChat=new p["default"]("ws://localhost:5050/?id="+this.props.username),this.myChat.onopen(function(){console.log("Connection stated")}),this.myChat.onclose(function(){console.log("Connection closed")})}},{key:"renderGroups",value:function(e,t){var n=this;return d["default"].map(e,function(e,o){var r={};return o===t&&(r={backgroundColor:"rgb(40, 157, 223)"}),l["default"].createElement("div",{style:[h.group,r],key:o},l["default"].createElement("div",{name:"group",style:h.groupItem,onClick:function(){n.clickGroup(o)}},o),l["default"].createElement("div",{style:h.deleteItem,onClick:function(e){n.handleExitGroup(e,o)}},"X"))})}},{key:"renderMsg",value:function(e){return e.map(function(e,t){return l["default"].createElement("div",{key:t,style:h.msg},e)})}},{key:"renderMembers",value:function(e){return e.map(function(e,t){return l["default"].createElement("div",{key:t},e)})}},{key:"render",value:function(){var e=this.state,t=e.path,n=e.msg,o=e.groups,r=e.active,a=o[r]?o[r]:{msgs:[],members:[]},i=a.msgs,s=a.members;return l["default"].createElement("div",null,l["default"].createElement("section",{name:"groupsStage",style:h.groupsStage},this.renderGroups(o,r),l["default"].createElement("input",{value:t,onChange:this.handleChangePath}),l["default"].createElement("button",{type:"button",style:h.msgButton,onClick:this.handleClickAdd},"Add")),l["default"].createElement("section",{name:"msgStage",style:h.msgStage},l["default"].createElement("div",{name:"msgView",style:h.msgView},this.renderMsg(i)),l["default"].createElement("div",{name:"msgPost",style:h.msgPost},l["default"].createElement("input",{value:n,onChange:this.handleChangeMsg,style:h.msgInput}),l["default"].createElement("button",{type:"button",style:h.msgButton,onClick:this.handleClickPost},"Post"))),l["default"].createElement("section",{name:"membersStage",style:h.membersStage},this.renderMembers(s)))}}]),t}(l["default"].Component);g.propTypes={username:u.PropTypes.string.isRequired},t["default"]=g},295:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(1),l=o(u),c=n(248),p=o(c),f=n(246),d=o(f),h={chat:{position:"relative",width:"100%",height:"100%",overflow:"auto"}},g=function(e){function t(e){r(this,t);var n=a(this,Object.getPrototypeOf(t).call(this,e));return n.handleChangeUserName=function(e){n.setState({username:e})},n.state={username:""},n}return i(t,e),s(t,[{key:"render",value:function(){var e=this.state.username;return l["default"].createElement("div",{name:"chat",style:h.chat},e?l["default"].createElement(p["default"],{username:e}):l["default"].createElement(d["default"],{onChange:this.handleChangeUserName}))}}]),t}(l["default"].Component);e.exports=g}});